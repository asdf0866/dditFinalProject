<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.mapper.IFileMapper">

	<select id="getFileNo" parameterType="String" resultType="int">
		SELECT COUNT(DISTINCT FILE_ID)
		FROM ATTACH_FILE
		WHERE FILE_ID LIKE #{String}||'%'
	</select>
	
	<insert id="attachFileRegister" parameterType="fileVO">
		INSERT INTO ATTACH_FILE(
			FILE_ID, FILE_SERIAL_NO, FILE_ORIGIN_NAME, FILE_SAVE_NAME, FILE_CONTENT_TYPE, 
			FILE_SIZE, FILE_PATH, FILE_REG_YMD
		)
		VALUES(
			#{fileId} , #{fileSerialNo}, #{fileOriginName}, #{fileSaveName}, #{fileContentType},
			#{fileSize}, #{filePath}, TO_CHAR(SYSDATE, 'yyyyMMdd')
		)
	</insert>
	
	<select id="getFileList" parameterType="String" resultType="fileVO">
		SELECT FILE_ID, FILE_SERIAL_NO, FILE_ORIGIN_NAME, FILE_SAVE_NAME, FILE_CONTENT_TYPE 
			 , FILE_SIZE, FILE_PATH, FILE_REG_YMD, FILE_CHG_YMD, FILE_DEL_YN
		  FROM ATTACH_FILE
		 WHERE 1 = 1
		   AND FILE_ID = #{fileId}
		   AND FILE_DEL_YN = 'N'
		 ORDER BY FILE_SERIAL_NO
	</select>
	
	<select id="getFile" parameterType="fileVO" resultType="fileVO">
		SELECT FILE_ID, FILE_SERIAL_NO, FILE_ORIGIN_NAME, FILE_SAVE_NAME, FILE_CONTENT_TYPE 
			 , FILE_SIZE, FILE_PATH, FILE_REG_YMD, FILE_CHG_YMD, FILE_DEL_YN
		  FROM ATTACH_FILE
		 WHERE 1 = 1
		   AND FILE_ID = #{fileId}
		   AND FILE_SERIAL_NO = #{fileSerialNo}
	</select>
	
	<update id="delFile" parameterType="fileVO">
		UPDATE ATTACH_FILE
		   SET FILE_DEL_YN = 'Y', FILE_CHG_YMD = TO_CHAR(SYSDATE, 'yyyyMMdd')
		 WHERE 1 = 1
		   AND FILE_ID = #{fileId}
		   AND FILE_SERIAL_NO = #{fileSerialNo} 
	</update>
	
	<select id="getFileCount" parameterType="String" resultType="int">
		SELECT COUNT(FILE_SERIAL_NO)
		  FROM ATTACH_FILE
		 WHERE 1 = 1
		   AND FILE_ID = #{fileId}
	</select>
</mapper>